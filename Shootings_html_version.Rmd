---
title: "US Mass Shootings 1982 to 2019"
output: html_document
css: "Shootings.css"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r import_data, include=FALSE}
library(tidyverse)
library(operators)
library(magrittr)
library(dplyr)
library(knitr)
library(sf)
library(usmap)
library(waffle)

# Import the shootings data from the CSV file and save it as a data frame called imported_data
imported_data <- read.csv("ShootingsData.csv", strip.white = TRUE)

# Create a copy of the data to change during cleansing, so that the original data is preserved
cleansed_data <- imported_data
```

```{r cleanse_data, include=FALSE}

# Create new column containing 1 for each row, to use when showing number of shootings per grouping
cleansed_data$for_count <- 1

# Update the gender column so that there is only one version of "Female" etc
cleansed_data$gender = case_when(
   cleansed_data$gender == "M" ~ "Male",
   cleansed_data$gender == "Male" ~ "Male",
   cleansed_data$gender == "F" ~ "Female",
   cleansed_data$gender == "Female" ~ "Female",
   cleansed_data$gender == "Male & Female" ~ "Male & Female"
)

# Update the race column so that there is only one version of Unknown, Black, White etc
cleansed_data$race = case_when(
   cleansed_data$race == "Other" ~ "Unknown",
   cleansed_data$race == "-" ~ "Unknown",
   cleansed_data$race == "unclear" ~ "Unknown",
   cleansed_data$race == "" ~ "Unknown",
   cleansed_data$race == "black" ~ "Black",
   cleansed_data$race == "Black" ~ "Black",
   cleansed_data$race == "Latino" ~ "Latino",
   cleansed_data$race == "Native American" ~ "Native American",
   cleansed_data$race == "white" ~ "White",
   cleansed_data$race == "White" ~ "White",
   cleansed_data$race == "White " ~ "White"
)

# For rows where race is NA, set it to Unknown
cleansed_data[is.na(cleansed_data$race), "race"] <- "Unknown"


# Update the "Weapons Obtained Legally" column so that there is only one version of "Yes" etc
cleansed_data$weapons_obtained_legally = case_when(
   cleansed_data$weapons_obtained_legally == "No" ~ "No",
   cleansed_data$weapons_obtained_legally == "TBD" ~ "Unknown",
   cleansed_data$weapons_obtained_legally == "-" ~ "Unknown",
   cleansed_data$weapons_obtained_legally == "Unknown" ~ "Unknown",
   cleansed_data$weapons_obtained_legally == "Kelley passed federal criminal background checks; the US Air Force failed to provide information on his criminal history to the FBI" ~ "Unknown",
   cleansed_data$weapons_obtained_legally == "Yes" ~ "Yes",
   cleansed_data$weapons_obtained_legally == "\nYes" ~ "Yes",
   cleansed_data$weapons_obtained_legally == "Yes " ~ "Yes",
   cleansed_data$weapons_obtained_legally %!in% c("Yes", "\nYes", "No", "Unknown", "-", "TBD") ~ "Unknown"
)

# Set weapons_obtained_legally to "Yes" for the Chattanooga military recruitment center shooting. The value in the imported data set contains quotes and I haven't figured out how to get the match condition to work with that value yet so this is a temporary workaround.
cleansed_data[cleansed_data$case == "Chattanooga military recruitment center", "weapons_obtained_legally"] <- "Yes"

# Create a new column containing the text after the comma in the location column
cleansed_data$state <- sub('.*\\,', '', cleansed_data$location)

# Strip leading white spaces from state
cleansed_data$state <- sub("^\\s+", "", cleansed_data$state)

# Replace state names with their codes e.g. California becomes CA
cleansed_data$state <- ifelse(cleansed_data$state == "California", "CA", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Pennsylvania", "PA", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Florida", "FL", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Ohio", "OH", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Washington", "WA", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Lousiana", "LA", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Texas", "TX", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Kansas", "KS", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Michigan", "MI", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Colorado", "CO", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Oregon", "OR", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Tennessee", "TN", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "South Carolina", "SC", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Wisconsin", "WI", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "New York", "NY", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Connecticut", "CT", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Minnesota", "MN", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Georgia", "GA", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Nevada", "NV", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Arizona", "AZ", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "North Carolina", "NC", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Kentucky", "KY", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Illinois", "IL", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Missouri", "MO", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Nebraska", "NE", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Virginia", "VA", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Utah", "UT", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Mississippi", "MS", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Massachusetts", "MA", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Hawaii", "HI", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Arkansas", "AR", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Iowa", "IA", cleansed_data$state)
cleansed_data$state <- ifelse(cleansed_data$state == "Oklahoma", "OK", cleansed_data$state)

# Strip leading white spaces from location.1 so that there's only one instance of "Workplace"
cleansed_data$location.1 <- sub("^\\s+", "", cleansed_data$location.1)

# Strip trailing white spaces from location.1 so that there's only one instance of "Other"
cleansed_data$location.1 <- sub("\\s+$", "", cleansed_data$location.1)

# Change "-", "TBD" and "Unclear" to "Unknown"
cleansed_data$prior_signs_mental_health_issues = case_when(
   cleansed_data$prior_signs_mental_health_issues == "-" ~ "Unknown",
   cleansed_data$prior_signs_mental_health_issues == "No" ~ "No",
   cleansed_data$prior_signs_mental_health_issues == "TBD" ~ "Unknown",
   cleansed_data$prior_signs_mental_health_issues == "Unclear" ~ "Unknown",
   cleansed_data$prior_signs_mental_health_issues == "Unknown" ~ "Unknown",
   cleansed_data$prior_signs_mental_health_issues == "Yes" ~ "Yes"
)

```

## US Mass Shootings By State

```{r create_state_summary, include=FALSE}

# Create a new data frame that shows number of shootings by state
shootings_per_state <- data.frame(table(cleansed_data$state))

# Change the column heading names to "state" and "shootings"
colnames(shootings_per_state) <- c("state", "shootings")

```


```{r display_plot_state, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by state
plot_state_bar <- ggplot(shootings_per_state, aes(y=shootings, x=reorder(state, shootings))) + 
  geom_bar(position="dodge", stat="identity", fill = "#e14646") +
  coord_flip() +
  labs(x = "state") +
  geom_text(aes(label=shootings), hjust = -0.5, size = 4, col = "#666666") +
  theme(
    axis.text.x = element_text(colour = "#666666", size = 8),
    axis.text.y = element_text(colour = "#666666", size = 8, hjust = 1),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    title = element_text(colour = "#666666"),
    axis.line.x = element_line(colour = "#666666")
    ) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 20))

# Display the bar chart 
plot_state_bar

# Create a chart showing the states on a map of the US and shade the states by the number of shootings
plot_state_map_shootings <- plot_usmap(data = shootings_per_state, values = "shootings", regions = "states", labels = TRUE) +
  scale_fill_continuous(low = "white", high = "#e14646", name = "shootings") +
  theme(legend.position = "right")

# Display the map chart
plot_state_map_shootings
```

**California** is the state that has had the most mass shootings.  

17% of the mass shootings were in California.

## US Mass Shooting Victims By State

```{r create_state_victims_summary, include=FALSE}

# Create a new data frame that shows number of victims by state
victims_by_state <- aggregate(cleansed_data$total_victims, by=list(cleansed_data$state), FUN = sum)

# Change the column heading names to "state" and "victims"
colnames(victims_by_state) <- c("state", "victims")

```


```{r display_plot_state_victims, echo=FALSE, fig.width=10, fig.height=5}

# Create a chart showing the states on a map of the US and shade the states by the number of victims
plot_state_map_victims <- plot_usmap(data = victims_by_state, values = "victims", regions = "states", labels = TRUE) +
  scale_fill_continuous(low = "white", high = "#46b7e1", name = "victims") +
  theme(legend.position = "right")

# Display the map chart
plot_state_map_victims

```

## US Mass Shootings Over Time


```{r create_year_summary, include=FALSE}

# Create a new data frame that shows number of shootings per year
shootings_per_year <- data.frame(table(cleansed_data$year))

# Change the column heading names to "year" and "shootings"
colnames(shootings_per_year) <- c("year", "shootings")
```

```{r display_plot_year, echo=FALSE, fig.height=5, fig.width=10}

# Create a line graph showing the number of mass shootings per year
my_line_plot <- ggplot(data=shootings_per_year, aes(x=year, y=shootings, group=1)) +
  geom_line(color="#49a4aa", size = 1)+
  geom_point(color="#49a4aa")+
  labs(x = "Year",
       y = "Number of mass shootings")+
  geom_text(aes(label=shootings), vjust = -1, size = 3, col = "#666666", fontface = "bold")+
  theme(
    axis.text.y = element_text(colour = "#666666", size = 7.5),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    axis.line.x = element_line(colour = "#666666"),
    axis.line.y = element_line(colour = "#666666"))+
    geom_smooth(method = "loess", colour = "#666666", linetype = 2, size = 0.5 )

# Display the line plot
my_line_plot

```

The number of mass shootings in the US is **increasing**.  

The year with the most shootings was **2018** which consisted of **11%** of the mass shootings.


## US Mass Shootings By Gender

```{r create_gender_summary, include=FALSE}

# Create a new data frame that shows number of shootings per gender
shootings_per_gender <- data.frame(table(cleansed_data$gender))

# Change the column heading names to "gender" and "shootings"
colnames(shootings_per_gender) <- c("gender", "shootings")
```

### 96%

of mass shooters were **men**.

## US Mass Shootings By Race

```{r create_race_summary, include=FALSE}

# Create a new data frame that shows number of shootings per race
shootings_per_race <- data.frame(table(cleansed_data$race))

# Change the column heading names to "race" and "shootings"
colnames(shootings_per_race) <- c("race", "shootings")
```

```{r display_plot_race, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings per race
plot_race <- ggplot(shootings_per_race, aes(y=shootings, x=reorder(race, -shootings))) + 
  geom_bar(position="dodge", stat="identity", fill = "#e27f46") +
  labs(x = "race",
       y = "number of mass shootings") +
  geom_text(aes(label=shootings), vjust = -0.5, size = 4, col = "#666666") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart showing shootings per race
plot_race

```

56% of mass shooters were **white**.

## Were There Prior Signs of Mental Health Issues?

```{r create_prior_summary, include=FALSE}

# Create a new data frame that shows number of shootings per race
shootings_per_prior <- data.frame(table(cleansed_data$prior_signs_mental_health_issues))

# Change the column heading names to "prior_signs_of_mental_health_issues" and "shootings"
colnames(shootings_per_prior) <- c("prior_signs_of_MH_issues", "shootings")
```

```{r display_plot_prior, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether there were prior signs of mental healh issues
plot_prior <- ggplot(shootings_per_prior, aes(y=shootings, x=reorder(prior_signs_of_MH_issues, -shootings))) + 
  geom_bar(position="dodge", stat="identity", fill = "#e14646") +
  labs(x = "prior signs of mental health issues",
       y = "number of mass shootings") +
  geom_text(aes(label=shootings), vjust = -0.5, size = 4, col = "#666666") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_prior

```

53% of mass shooters had **prior signs** of mental health issues.

## Were Weapons Obtained Legally?

```{r create_legally_summary, include=FALSE}

# Create a new data frame that shows number of shootings based on whether the weapons were obtained legally or not
shootings_per_legally <- data.frame(table(cleansed_data$weapons_obtained_legally))

# Change the column heading names to "legally" and "shootings"
colnames(shootings_per_legally) <- c("weapons_obtained_legally", "shootings")
```

```{r display_plot_legally, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether weapons were obtained legally
plot_legally <- ggplot(shootings_per_legally, aes(y=shootings, x=reorder(weapons_obtained_legally, -shootings))) + 
  geom_bar(position="dodge", stat="identity", fill = "#46b7e1") +
  labs(x = "wepons obtained legally",
       y = "number of mass shootings") +
  geom_text(aes(label=shootings), vjust = -0.5, size = 4, col = "#666666") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_legally

```

72% of mass shooters obtained weapons **legally**.

## US Mass Shootings By Location Type

```{r create_loc_type_summary, include=FALSE}

# Create a new data frame that shows number of shootings by location type
shootings_per_loc_type <- data.frame(table(cleansed_data$location.1))

# Change the column heading names to "location.1" and "shootings"
colnames(shootings_per_loc_type) <- c("location.1", "shootings")
```

```{r display_plot_loc_type, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by location type
plot_loc_type <- ggplot(shootings_per_loc_type, aes(y=shootings, x=reorder(location.1, -shootings))) + 
  geom_bar(position="dodge", stat="identity", fill = "#e1ad46") +
  labs(x = "location type",
       y = "number of mass shootings") +
  geom_text(aes(label=shootings), vjust = -0.5, size = 4, col = "#666666") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_loc_type

```
Putting locations classed as "Other" to one side, as we don't know what types are included in that classification, the **workplace** is the most common location type for mass shootings (33%), with schools being the next most common (15%).

## Age Of Shooter

```{r create_age_summary, include=FALSE}

# Create a new data frame that shows number of shootings by age
shootings_per_age <- data.frame(table(cleansed_data$age_of_shooter))

# Change the column heading names to "age" and "shootings"
colnames(shootings_per_age) <- c("age_of_shooter", "shootings")
```

```{r display_plot_age, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by age
plot_age <- ggplot(shootings_per_age, aes(y=shootings, x=age_of_shooter)) + 
  geom_bar(position="dodge", stat="identity", fill = "#e27f46") +
  labs(x = "age",
       y = "number of mass shootings") +
  geom_text(aes(label=shootings), vjust = -0.5, size = 4, col = "#666666", fontface = "bold") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_age

```

Shooter ages range from **11** to **66**.

## Age Bracket Of Shooter

```{r create_age_bracket_column, include=FALSE}

# Create a new column called age_bracket and populate it with the age bracket of each shooter. Age brackets are: Child, Teen, 20s, 30s, 40s, 50s, 60s.

cleansed_data$age_bracket <- case_when(
    cleansed_data$age_of_shooter <= 12 ~ "1-12",
    cleansed_data$age_of_shooter > 12 & cleansed_data$age_of_shooter < 20 ~ "13-19",
    cleansed_data$age_of_shooter >= 20 & cleansed_data$age_of_shooter < 30 ~ "20s",
    cleansed_data$age_of_shooter >= 30 & cleansed_data$age_of_shooter < 40 ~ "30s",
    cleansed_data$age_of_shooter >= 40 & cleansed_data$age_of_shooter < 50 ~ "40s",
    cleansed_data$age_of_shooter >= 50 & cleansed_data$age_of_shooter < 60 ~ "50s",
    cleansed_data$age_of_shooter >= 60 & cleansed_data$age_of_shooter < 70 ~ "60s"
)

```

```{r create_age_bracket_summary, include=FALSE}

# Create a new data frame that shows number of shootings by age bracket
shootings_per_age_bracket <- data.frame(table(cleansed_data$age_bracket))

# Change the column heading names to "age bracket" and "shootings"
colnames(shootings_per_age_bracket) <- c("age_bracket", "shootings")
```

```{r display_plot_age_bracket, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by age bracket
plot_age_bracket <- ggplot(shootings_per_age_bracket, aes(y=shootings, x=age_bracket)) + 
  geom_bar(position="dodge", stat="identity", fill = "#e14646") +
  labs(x = "age bracket",
       y = "number of mass shootings") +
  geom_text(aes(label=shootings), vjust = -0.5, size = 4, col = "#666666", fontface = "bold") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_age_bracket

```

The age bracket with the highest number of mass shootings is the **20s** (34% of mass shootings).

## Semi-Automatic Weapons

```{r create_semi_auto_used_column, include=FALSE}

# Create a new column called semi_auto_used and populate it with Yes or No depending on whether the shooter used a semi-automatic weapon

cleansed_data$semi_auto_used <- "No"

cleansed_data[grep("automatic", cleansed_data$weapon_type, ignore.case = TRUE), "semi_auto_used"] <- "Yes" 
```

```{r create_semi_summary, include=FALSE}

# Create a new data frame that shows number of shootings by whether semi automatic weapons were used
shootings_per_semi <- data.frame(table(cleansed_data$semi_auto_used))

# Change the column heading names to "semi automatic weapon used" and "shootings"
colnames(shootings_per_semi) <- c("semi_auto_used", "shootings")

# Add a Percentage column containing the % of shootings for each category (yes, no)
shootings_per_semi$percentage <- round(shootings_per_semi$shootings / sum(shootings_per_semi$shootings) * 100, 0)
```

```{r display_plot_semi_auto_used, echo=FALSE, fig.width=10, fig.height=2}

# Create a waffle chart
semi_auto_waffle <- waffle(c('Yes'=65, 'No'=35), rows = 4, colors = c('Yes'= "#49a4aa", 'No'="#e14646"))

# Display the waffle chart
semi_auto_waffle

```

65% of mass shootings involved **semi-automatic weapons**.

## Multiple Weapons

```{r create_multiple_weapons_used_column, include=FALSE}

# Create a new column called multiple_weapons_used and populate it with Yes or No depending on whether the shooter used more than one weapon

cleansed_data$multiple_weapons_used <- "No"

cleansed_data[grep("Two", cleansed_data$weapon_type, ignore.case = TRUE), "multiple_weapons_used"] <- "Yes" 

cleansed_data[grep("Three", cleansed_data$weapon_type, ignore.case = TRUE), "multiple_weapons_used"] <- "Yes" 

cleansed_data[grep("Five", cleansed_data$weapon_type, ignore.case = TRUE), "multiple_weapons_used"] <- "Yes"

cleansed_data[grep(" and ", cleansed_data$weapon_type, ignore.case = TRUE), "multiple_weapons_used"] <- "Yes" 

cleansed_data[grep(",", cleansed_data$weapon_type, ignore.case = TRUE), "multiple_weapons_used"] <- "Yes" 

cleansed_data[grep(";", cleansed_data$weapon_type, ignore.case = TRUE), "multiple_weapons_used"] <- "Yes" 

cleansed_data[grep("rifles", cleansed_data$weapon_type, ignore.case = TRUE), "multiple_weapons_used"] <- "Yes" 
```

```{r create_multiple_weapons_summary, include=FALSE}

# Create a new data frame that shows number of shootings by whether multiple weapons were used
shootings_per_multiple <- data.frame(table(cleansed_data$multiple_weapons_used))

# Change the column heading names to "multiple weapon used" and "shootings"
colnames(shootings_per_multiple) <- c("multiple_weapons_used", "shootings")

# Add a Percentage column containing the % of shootings for each category (yes, no)
shootings_per_multiple$percentage <- round(shootings_per_multiple$shootings / sum(shootings_per_multiple$shootings) * 100, 0)

```

```{r display_plot_multiple_weapons_used, echo=FALSE, fig.width=10, fig.height=2}

# Create a waffle chart
multiple_weapons_waffle <- waffle(c('Yes'=53, 'No'=47), rows = 4, colors = c('Yes'= "#49a4aa", 'No'="#e14646"))

# Display the waffle chart
multiple_weapons_waffle
```

53% of mass shootings involved **multiple weapons**.

## Year & Age Bracket

```{r create_year_age_summary, include=FALSE}
# Create a new data frame that shows number by year and age bracket
shootings_per_year_age <- aggregate(cleansed_data$for_count, by=list(cleansed_data$year, cleansed_data$age_bracket),FUN = sum)

# Change the column heading names to Year, Age_Bracket and Num_Shootings
colnames(shootings_per_year_age) <- c("Year", "Age_Bracket", "Num_Shootings")
```

```{r display_plot_year_age, echo=FALSE, fig.width=10, fig.height=5}
without_child_age_bracket <- shootings_per_year_age[shootings_per_year_age$Age_Bracket != "1-12", ]

# Create a faceted line graph showing the number of mass shootings per year for each age bracket
faceted_line_graph_year_age <- ggplot(data=without_child_age_bracket, aes(x=Year, y = Num_Shootings, colour = Age_Bracket, group=1)) + 
  geom_line()+
  geom_point()+
  geom_smooth(method = "lm", colour = "#666666", linetype = 2, size = 0.5 )+
  facet_wrap(~Age_Bracket)


# Display the faceted line graph
faceted_line_graph_year_age 
  
```

The age bracket "1-12" has been excluded from the charts because there was only one instance in that category and so there is little use trying to illustrate the pattern over time for that age bracket.

## State & Race

```{r create_state_race_summary, include=FALSE}
# Create a new data frame that shows number by state and race
shootings_per_state_race <- aggregate(cleansed_data$for_count, by=list(cleansed_data$state, cleansed_data$race),FUN = sum)

# Change the column heading names to State, Race and Num_Shootings
colnames(shootings_per_state_race) <- c("State", "Race", "Num_Shootings")
```

```{r display_plot_state_race, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by state and race
 plot_state_race <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=State, fill=Race), data = shootings_per_state_race, stat = "identity") +
  scale_fill_manual(values = c("#49a4aa", "#46b7e1", "#e14646", "#e27f46", "#e1ad46")) +
  labs(x = "State",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_state_race

```

## State & Semi-Automatic Weapons

```{r create_state_semi_summary, include=FALSE}
# Create a new data frame that shows number by state and whether semi-automatic weapons were used
shootings_per_state_semi <- aggregate(cleansed_data$for_count, by=list(cleansed_data$state, cleansed_data$semi_auto_used),FUN = sum)

# Change the column heading names to State, Semi_Auto_Weapons_Used, and Num_Shootings
colnames(shootings_per_state_semi) <- c("State", "Semi_Auto_Weapons_Used", "Num_Shootings")
```

```{r display_plot_state_semi, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by state and whether semi-automatic weapons were used
 plot_state_semi <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=State, fill=Semi_Auto_Weapons_Used), data = shootings_per_state_semi, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#49a4aa")) +
  labs(x = "State",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_state_semi

```
  
  
## State & Multiple Weapons

```{r create_state_multi_summary, include=FALSE}
# Create a new data frame that shows number by state and whether multiple weapons were used
shootings_per_state_multi <- aggregate(cleansed_data$for_count, by=list(cleansed_data$state, cleansed_data$multiple_weapons_used),FUN = sum)

# Change the column heading names to State, Multiple_Weapons_Used, and Num_Shootings
colnames(shootings_per_state_multi) <- c("State", "Multiple_Weapons_Used", "Num_Shootings")
```

```{r display_plot_state_multi, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by state and whether multiple weapons were used
 plot_state_multi <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=State, fill=Multiple_Weapons_Used), data = shootings_per_state_multi, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#49a4aa")) +
  labs(x = "State",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_state_multi

```
  
## State & Weapons Obtained Legally

```{r create_state_legally_summary, include=FALSE}
# Create a new data frame that shows number by state and whether weapons were obtained legally
shootings_per_state_legally <- aggregate(cleansed_data$for_count, by=list(cleansed_data$state, cleansed_data$weapons_obtained_legally),FUN = sum)

# Change the column heading names to State, Weapons_Obtained_Legally, and Num_Shootings
colnames(shootings_per_state_legally) <- c("State", "Weapons_Obtained_Legally", "Num_Shootings")
```

```{r display_plot_state_legally, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by state and whether weapons were obtained legally
 plot_state_legally <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=State, fill=Weapons_Obtained_Legally), data = shootings_per_state_legally, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#49a4aa", "#e1ad46")) +
  labs(x = "State",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_state_legally

```  


## State & Location Type

```{r create_state_loc_type_summary, include=FALSE}
# Create a new data frame that shows number by state and location type
shootings_per_state_loc_type <- aggregate(cleansed_data$for_count, by=list(cleansed_data$state, cleansed_data$location.1),FUN = sum)

# Change the column heading names to State, Location_Type and Num_Shootings
colnames(shootings_per_state_loc_type) <- c("State", "Location_Type", "Num_Shootings")
```

```{r display_plot_state_loc_type, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by state and location type
 plot_state_loc_type <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=State, fill=Location_Type), data = shootings_per_state_loc_type, stat = "identity") +
  scale_fill_manual(values = c("#49a4aa", "#46b7e1", "#e14646", "#e27f46", "#e1ad46", "#666666")) +
  labs(x = "State",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_state_loc_type

```

## State & Prior Signs of Mental Health Issues

```{r create_state_prior_summary, include=FALSE}
# Create a new data frame that shows number by state and whether there were prior signs of mental health issues
shootings_per_state_prior <- aggregate(cleansed_data$for_count, by=list(cleansed_data$state, cleansed_data$prior_signs_mental_health_issues),FUN = sum)

# Change the column heading names to State, Prior_Signs_Of_Mental_Health_Issues, and Num_Shootings
colnames(shootings_per_state_prior) <- c("State", "Prior_Signs_Of_Mental_Health_Issues", "Num_Shootings")
```

```{r display_plot_state_prior, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by state and whether there were prior signs of mental health issues
 plot_state_prior <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=State, fill=Prior_Signs_Of_Mental_Health_Issues), data = shootings_per_state_prior, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#49a4aa", "#e1ad46")) +
  labs(x = "State",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_state_prior

```  

## State & Age Bracket

```{r create_state_age_summary, include=FALSE}
# Create a new data frame that shows number by state and age bracket
shootings_per_state_age <- aggregate(cleansed_data$for_count, by=list(cleansed_data$state, cleansed_data$age_bracket),FUN = sum)

# Change the column heading names to State, Age_Bracket and Num_Shootings
colnames(shootings_per_state_age) <- c("State", "Age_Bracket", "Num_Shootings")
```

```{r display_plot_state_age, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by state and age bracket
 plot_state_age <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=State, fill=Age_Bracket), data = shootings_per_state_age, stat = "identity") +
  scale_fill_manual(values = c("#49a4aa", "#46b7e1", "#e14646", "#e27f46", "#e1ad46", "#666666", "#e0e1e2")) +
  labs(x = "State",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_state_age

```

## Year & Semi-Automatic Weapons

```{r create_year_semi_summary, include=FALSE}
# Create a new data frame that shows number by year and whether semi-automatic weapons were used
shootings_per_year_semi <- aggregate(cleansed_data$for_count, by=list(cleansed_data$year, cleansed_data$semi_auto_used),FUN = sum)

# Change the column heading names to Year, Semi_Auto_Weapons_Used, and Num_Shootings
colnames(shootings_per_year_semi) <- c("Year", "Semi_Auto_Weapons_Used", "Num_Shootings")
```

```{r display_plot_year_semi, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by year and whether semi-automatic weapons were used
 plot_year_semi <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Year, fill=Semi_Auto_Weapons_Used), data = shootings_per_year_semi, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#49a4aa")) +
  labs(x = "Year",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_year_semi

```

## Year & Multiple Weapons

```{r create_year_multi_summary, include=FALSE}
# Create a new data frame that shows number by year and whether multiple weapons were used
shootings_per_year_multi <- aggregate(cleansed_data$for_count, by=list(cleansed_data$year, cleansed_data$multiple_weapons_used),FUN = sum)

# Change the column heading names to Year, Multiple_Weapons_Used, and Num_Shootings
colnames(shootings_per_year_multi) <- c("Year", "Multiple_Weapons_Used", "Num_Shootings")
```

```{r display_plot_year_multi, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by year and whether multiple weapons were used
 plot_year_multi <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Year, fill=Multiple_Weapons_Used), data = shootings_per_year_multi, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#49a4aa")) +
  labs(x = "Year",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_year_multi

```


## Year & Prior Signs of Mental Health Issues

```{r create_year_prior_summary, include=FALSE}
# Create a new data frame that shows number by year and whether there were prior signs of mental health issues
shootings_per_year_prior <- aggregate(cleansed_data$for_count, by=list(cleansed_data$year, cleansed_data$prior_signs_mental_health_issues),FUN = sum)

# Change the column heading names to Year, Prior_Signs_Of_Mental_Health_Issues, and Num_Shootings
colnames(shootings_per_year_prior) <- c("Year", "Prior_Signs_Of_Mental_Health_Issues", "Num_Shootings")
```

```{r display_plot_year_prior, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by year and whether there were prior signs of mental health issues
 plot_year_prior <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Year, fill=Prior_Signs_Of_Mental_Health_Issues), data = shootings_per_year_prior, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#49a4aa", "#e1ad46")) +
  labs(x = "Year",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_year_prior

```  

## Year & Weapons Obtained Legally

```{r create_year_legally_summary, include=FALSE}
# Create a new data frame that shows number by year and whether weapons were obtained legally
shootings_per_year_legally <- aggregate(cleansed_data$for_count, by=list(cleansed_data$year, cleansed_data$weapons_obtained_legally),FUN = sum)

# Change the column heading names to Year, Weapons_Obtained_Legally, and Num_Shootings
colnames(shootings_per_year_legally) <- c("Year", "Weapons_Obtained_Legally", "Num_Shootings")
```

```{r display_plot_year_legally, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by year and whether weapons were obtained legally
 plot_year_legally <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Year, fill=Weapons_Obtained_Legally), data = shootings_per_year_legally, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#49a4aa", "#e1ad46")) +
  labs(x = "Year",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_year_legally

```  

## Year & Location Type

```{r create_year_loc_type_summary, include=FALSE}
# Create a new data frame that shows number by year and location type
shootings_per_year_loc_type <- aggregate(cleansed_data$for_count, by=list(cleansed_data$year, cleansed_data$location.1),FUN = sum)

# Change the column heading names to Year, Location_Type and Num_Shootings
colnames(shootings_per_year_loc_type) <- c("Year", "Location_Type", "Num_Shootings")
```

```{r display_plot_year_loc_type, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by year and location type
 plot_year_loc_type <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Year, fill=Location_Type), data = shootings_per_year_loc_type, stat = "identity") +
  scale_fill_manual(values = c("#49a4aa", "#46b7e1", "#e14646", "#e27f46", "#e1ad46", "#666666")) +
  labs(x = "Year",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_year_loc_type

```

## Semi-Automatic Weapons & Prior Signs of Mental Health Issues

```{r create_semi_prior_summary, include=FALSE}
# Create a new data frame that shows number by whether there were prior signs of mental health issues and whether semi-automatic weapons were used
shootings_per_semi_prior <- aggregate(cleansed_data$for_count, by=list(cleansed_data$semi_auto_used, cleansed_data$prior_signs_mental_health_issues),FUN = sum)

# Change the column heading names to Semi_Auto_Used, Prior_Signs_Of_Mental_Health_Issues, and Num_Shootings
colnames(shootings_per_semi_prior) <- c("Semi_Auto_Used", "Prior_Signs_Of_Mental_Health_Issues", "Num_Shootings")
```

```{r display_plot_semi_prior, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether there were prior signs of mental health issues and whether a semi-automatic weapon was used
 plot_semi_prior <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Semi_Auto_Used, fill=Prior_Signs_Of_Mental_Health_Issues), data = shootings_per_semi_prior, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#49a4aa", "#e1ad46")) +
  labs(x = "Semi Automatic Weapons Used?",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_semi_prior

```  

## Multiple Weapons & Prior Signs of Mental Health Issues

```{r create_multi_prior_summary, include=FALSE}
# Create a new data frame that shows number by whether there were prior signs of mental health issues and whether multiple weapons were used
shootings_per_multi_prior <- aggregate(cleansed_data$for_count, by=list(cleansed_data$multiple_weapons_used, cleansed_data$prior_signs_mental_health_issues),FUN = sum)

# Change the column heading names to Multiple_Weapons_Used, Prior_Signs_Of_Mental_Health_Issues, and Num_Shootings
colnames(shootings_per_multi_prior) <- c("Multiple_Weapons_Used", "Prior_Signs_Of_Mental_Health_Issues", "Num_Shootings")
```

```{r display_plot_multi_prior, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether there were prior signs of mental health issues and whether multiple weapons were used
 plot_multi_prior <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Multiple_Weapons_Used, fill=Prior_Signs_Of_Mental_Health_Issues), data = shootings_per_multi_prior, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#49a4aa", "#e1ad46")) +
  labs(x = "Multiple Weapons Used?",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_multi_prior

```  

## Multiple Weapons & Semi-Automatic Weapons

```{r create_multi_semi_summary, include=FALSE}
# Create a new data frame that shows number by whether semi-automatic weapons were used and whether multiple weapons were used
shootings_per_multi_semi <- aggregate(cleansed_data$for_count, by=list(cleansed_data$multiple_weapons_used, cleansed_data$semi_auto_used),FUN = sum)

# Change the column heading names to Multiple_Weapons_Used, Semi_Auto_Used, and Num_Shootings
colnames(shootings_per_multi_semi) <- c("Multiple_Weapons_Used", "Semi_Auto_Used", "Num_Shootings")
```

```{r display_plot_multi_semi, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether there were psemi-automatic weapons used and whether multiple weapons were used
 plot_multi_semi <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Multiple_Weapons_Used, fill=Semi_Auto_Used), data = shootings_per_multi_semi, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#49a4aa", "#e1ad46")) +
  labs(x = "Multiple Weapons Used?",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_multi_semi

```  

## Semi-Automatic Weapons & Age Bracket

```{r create_semi_age_summary, include=FALSE}
# Create a new data frame that shows number by age bracket and whether semi-automatic weapons were used
shootings_per_semi_age <- aggregate(cleansed_data$for_count, by=list(cleansed_data$semi_auto_used, cleansed_data$age_bracket),FUN = sum)

# Change the column heading names to Semi_Auto_Used, Age_Bracket and Num_Shootings
colnames(shootings_per_semi_age) <- c("Semi_Auto_Used", "Age_Bracket", "Num_Shootings")
```

```{r display_plot_semi_age, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by age bracket and whether semi-automatic weapons were used
 plot_semi_age <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Semi_Auto_Used, fill=Age_Bracket), data = shootings_per_semi_age, stat = "identity") +
  scale_fill_manual(values = c("#49a4aa", "#46b7e1", "#e14646", "#e27f46", "#e1ad46", "#666666", "#e0e1e2")) +
  labs(x = "Semi Automatic Weapons Used?",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_semi_age

```

## Weapons Obtained Legally & Age Bracket

```{r create_legally_age_summary, include=FALSE}
# Create a new data frame that shows number by age bracket and whether weapons were obtained legally
shootings_per_legally_age <- aggregate(cleansed_data$for_count, by=list(cleansed_data$weapons_obtained_legally, cleansed_data$age_bracket),FUN = sum)

# Change the column heading names to Weapons_Obtained_Legally, Age_Bracket and Num_Shootings
colnames(shootings_per_legally_age) <- c("Weapons_Obtained_Legally", "Age_Bracket", "Num_Shootings")
```

```{r display_plot_legally_age, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by age bracket and whether weapons were obtained legally
 plot_legally_age <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Age_Bracket, fill=Weapons_Obtained_Legally), data = shootings_per_legally_age, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#e1ad46", "#49a4aa")) +
  labs(x = "Age Bracket",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_legally_age

```

## Multiple Weapons & Age Bracket

```{r create_multi_age_summary, include=FALSE}
# Create a new data frame that shows number by age bracket and whether multiple weapons were used
shootings_per_multi_age <- aggregate(cleansed_data$for_count, by=list(cleansed_data$multiple_weapons_used, cleansed_data$age_bracket),FUN = sum)

# Change the column heading names to Multiple_Weapons_Used, Age_Bracket and Num_Shootings
colnames(shootings_per_multi_age) <- c("Multiple_Weapons_Used", "Age_Bracket", "Num_Shootings")
```

```{r display_plot_multi_age, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by age bracket and whether multiple weapons were used
 plot_multi_age <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Age_Bracket, fill=Multiple_Weapons_Used), data = shootings_per_multi_age, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#49a4aa")) +
  labs(x = "Age Bracket",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_multi_age

```

## Multiple Weapons & Weapons Obtained Legally

```{r create_multi_legally_summary, include=FALSE}
# Create a new data frame that shows number by whether weapons were obtained legally and whether multiple weapons were used
shootings_per_multi_legally <- aggregate(cleansed_data$for_count, by=list(cleansed_data$multiple_weapons_used, cleansed_data$weapons_obtained_legally),FUN = sum)

# Change the column heading names to Multiple_Weapons_Used, Weapons_Obtained_Legally and Num_Shootings
colnames(shootings_per_multi_legally) <- c("Multiple_Weapons_Used", "Weapons_Obtained_Legally", "Num_Shootings")
```

```{r display_plot_multi_legally, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether weapons were obtained legally and whether multiple weapons were used
 plot_multi_legally <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Weapons_Obtained_Legally, fill=Multiple_Weapons_Used), data = shootings_per_multi_legally, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#49a4aa")) +
  labs(x = "Weapons Obtained Legally?",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_multi_legally

```

## Semi-Automatic Weapons & Weapons Obtained Legally

```{r create_semi_legally_summary, include=FALSE}
# Create a new data frame that shows number by whether weapons were obtained legally and whether semi-automatic weapons were used
shootings_per_semi_legally <- aggregate(cleansed_data$for_count, by=list(cleansed_data$semi_auto_used, cleansed_data$weapons_obtained_legally),FUN = sum)

# Change the column heading names to Semi_Auto_Used, Weapons_Obtained_Legally and Num_Shootings
colnames(shootings_per_semi_legally) <- c("Semi_Auto_Used", "Weapons_Obtained_Legally", "Num_Shootings")
```

```{r display_plot_semi_legally, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether weapons were obtained legally and whether semi-automatic weapons were used
 plot_semi_legally <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Weapons_Obtained_Legally, fill=Semi_Auto_Used), data = shootings_per_semi_legally, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#49a4aa")) +
  labs(x = "Weapons Obtained Legally?",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_semi_legally

```

## Age Bracket & Prior Signs of Mental Health Issues

```{r create_age_prior_summary, include=FALSE}
# Create a new data frame that shows number by whether there were prior signs of mental health issues and age bracket
shootings_per_age_prior <- aggregate(cleansed_data$for_count, by=list(cleansed_data$age_bracket, cleansed_data$prior_signs_mental_health_issues),FUN = sum)

# Change the column heading names to Age_Bracket, Prior_Signs_Of_Mental_Health_Issues, and Num_Shootings
colnames(shootings_per_age_prior) <- c("Age_Bracket", "Prior_Signs_Of_Mental_Health_Issues", "Num_Shootings")
```

```{r display_plot_age_prior, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether there were prior signs of mental health issues and age bracket
 plot_age_prior <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Age_Bracket, fill=Prior_Signs_Of_Mental_Health_Issues), data = shootings_per_age_prior, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#e1ad46", "#49a4aa")) +
  labs(x = "Age Bracket",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_age_prior

```  

## Location Type & Prior Signs of Mental Health Issues

```{r create_loc_type_prior_summary, include=FALSE}
# Create a new data frame that shows number by whether there were prior signs of mental health issues and location type
shootings_per_loc_type_prior <- aggregate(cleansed_data$for_count, by=list(cleansed_data$location.1, cleansed_data$prior_signs_mental_health_issues),FUN = sum)

# Change the column heading names to Location_Type, Prior_Signs_Of_Mental_Health_Issues, and Num_Shootings
colnames(shootings_per_loc_type_prior) <- c("Location_Type", "Prior_Signs_Of_Mental_Health_Issues", "Num_Shootings")
```

```{r display_plot_loc_type_prior, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether there were prior signs of mental health issues and location type
 plot_loc_type_prior <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Location_Type, fill=Prior_Signs_Of_Mental_Health_Issues), data = shootings_per_loc_type_prior, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#e1ad46", "#49a4aa")) +
  labs(x = "Location Type",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_loc_type_prior

```  

## Weapons Obtained Legally & Prior Signs of Mental Health Issues

```{r create_legally_prior_summary, include=FALSE}
# Create a new data frame that shows number by whether there were prior signs of mental health issues and whether weapons were obtained legally
shootings_per_legally_prior <- aggregate(cleansed_data$for_count, by=list(cleansed_data$weapons_obtained_legally, cleansed_data$prior_signs_mental_health_issues),FUN = sum)

# Change the column heading names to Weapons_Obtained_Legally, Prior_Signs_Of_Mental_Health_Issues, and Num_Shootings
colnames(shootings_per_legally_prior) <- c("Weapons_Obtained_Legally", "Prior_Signs_Of_Mental_Health_Issues", "Num_Shootings")
```

```{r display_plot_legally_prior, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by whether there were prior signs of mental health issues and whether weapons were obtained legally
 plot_legally_prior <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Weapons_Obtained_Legally, fill=Prior_Signs_Of_Mental_Health_Issues), data = shootings_per_legally_prior, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#e1ad46", "#49a4aa")) +
  labs(x = "Weapons Obtained Legally?",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_legally_prior

```  

## Location Type & Age Bracket

```{r create_loc_type_age_summary, include=FALSE}
# Create a new data frame that shows number by age bracket and location type
shootings_per_loc_type_age <- aggregate(cleansed_data$for_count, by=list(cleansed_data$location.1, cleansed_data$age_bracket),FUN = sum)

# Change the column heading names to Location_Type, Age_Bracket and Num_Shootings
colnames(shootings_per_loc_type_age) <- c("Location_Type", "Age_Bracket", "Num_Shootings")
```

```{r display_plot_loc_type_age, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by age bracket and location type
 plot_loc_type_age <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Location_Type, fill=Age_Bracket), data = shootings_per_loc_type_age, stat = "identity") +
  scale_fill_manual(values = c("#49a4aa", "#46b7e1", "#e14646", "#e27f46", "#e1ad46", "#666666", "#e0e1e2")) +
  labs(x = "Location Type",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_loc_type_age

```

## Location Type & Semi Automatic Weapons

```{r create_loc_type_semi_summary, include=FALSE}
# Create a new data frame that shows number by location type and whether semi-automatic weapons were used
shootings_per_loc_type_semi <- aggregate(cleansed_data$for_count, by=list(cleansed_data$location.1, cleansed_data$semi_auto_used),FUN = sum)

# Change the column heading names to Location_Type, Semi_Auto_Used and Num_Shootings
colnames(shootings_per_loc_type_semi) <- c("Location_Type", "Semi_Auto_Used", "Num_Shootings")
```

```{r display_plot_loc_type_semi, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by location type and whether semi-automatic weapons were used
 plot_loc_type_semi <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Location_Type, fill=Semi_Auto_Used), data = shootings_per_loc_type_semi, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#49a4aa")) +
  labs(x = "Location Type",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_loc_type_semi

```

## Location Type & Multiple Weapons

```{r create_loc_type_multi_summary, include=FALSE}
# Create a new data frame that shows number by location type and whether multiple weapons were used
shootings_per_loc_type_multi <- aggregate(cleansed_data$for_count, by=list(cleansed_data$location.1, cleansed_data$multiple_weapons_used),FUN = sum)

# Change the column heading names to Location_Type, Multiple_Weapons_Used and Num_Shootings
colnames(shootings_per_loc_type_multi) <- c("Location_Type", "Multiple_Weapons_Used", "Num_Shootings")
```

```{r display_plot_loc_type_multi, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by location type and whether multiple weapons were used
 plot_loc_type_multi <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Location_Type, fill=Multiple_Weapons_Used), data = shootings_per_loc_type_multi, stat = "identity") +
  scale_fill_manual(values = c("#e14646", "#49a4aa")) +
  labs(x = "Location Type",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_loc_type_multi

```

## Location Type & Race

```{r create_loc_type_race_summary, include=FALSE}
# Create a new data frame that shows number by location type and race
shootings_per_loc_type_race <- aggregate(cleansed_data$for_count, by=list(cleansed_data$location.1, cleansed_data$race),FUN = sum)

# Change the column heading names to Location_Type, Race and Num_Shootings
colnames(shootings_per_loc_type_race) <- c("Location_Type", "Race", "Num_Shootings")
```

```{r display_plot_loc_type_race, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by location type and race
 plot_loc_type_race <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Location_Type, fill=Race), data = shootings_per_loc_type_race, stat = "identity") +
  scale_fill_manual(values = c("#49a4aa", "#46b7e1", "#e14646", "#e27f46", "#e1ad46", "#666666", "#e0e1e2")) +
  labs(x = "Location Type",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_loc_type_race

```

## Age Bracket & Race

```{r create_age_race_summary, include=FALSE}
# Create a new data frame that shows number by age bracket and race
shootings_per_age_race <- aggregate(cleansed_data$for_count, by=list(cleansed_data$age_bracket, cleansed_data$race),FUN = sum)

# Change the column heading names to Age_Bracket, Race and Num_Shootings
colnames(shootings_per_age_race) <- c("Age_Bracket", "Race", "Num_Shootings")
```

```{r display_plot_age_race, echo=FALSE, fig.width=10, fig.height=5}

# Create a bar chart using ggplot2 to show shootings by age bracket and race
 plot_age_race <- ggplot() + 
  geom_bar(aes(y=Num_Shootings, x=Age_Bracket, fill=Race), data = shootings_per_age_race, stat = "identity") +
  scale_fill_manual(values = c("#49a4aa", "#46b7e1", "#e14646", "#e27f46", "#e1ad46", "#666666", "#e0e1e2")) +
  labs(x = "Age Bracket",
       y = "Number of mass shootings") +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_text(colour = "#666666", size = 7.5),
    axis.ticks = element_blank(),
    title = element_text(colour = "#666666"),
    plot.title = element_text(hjust = 0.5),
    panel.background = element_blank(),
    axis.line.x = element_line(colour = "#666666")) 

# Display the bar chart 
plot_age_race

```

## About This Data

The dashboard is powered by data on US mass shootings 1982 - 2019 and has been provided by Mother Jones.  

The download is available at:  

https://www.motherjones.com/politics/2012/12/mass-shootings-mother-jones-full-data/

## Data Cleansing Changes - Gender

The original breakdown of number of mass shootings by gender was:

```{r cleanse_data_gender_before, echo=FALSE}

# Create a data frame containing the unique list of genders in the original data, and the number of mass shootings by each
unique_genders <- data.frame(table(imported_data$gender))

# Change the column heading names to "Gender" and "Shootings"
colnames(unique_genders) <- c("Gender", "Shootings")

# Display the values for gender, and the total shootings for each, in the imported data in a table
kable(unique_genders)
```

The cleansed breakdown is:  

```{r cleanse_data_gender_after, echo=FALSE}

# Create a data frame containing the unique list of genders in the cleansed data, and the number of mass shootings by each
unique_genders <- data.frame(table(cleansed_data$gender))

# Change the column heading names to "Gender" and "Shootings"
colnames(unique_genders) <- c("Gender", "Shootings")

# View the values for gender, and the total shootings for each, in the cleansed data:
kable(unique_genders)
```
  

## Data Cleansing Changes - Race

The original breakdown of number of mass shootings by race was:

```{r cleanse_data_race_before, echo=FALSE}

# Create a data frame containing the unique list of race values in the original data, and the number of mass shootings by each
unique_races <- data.frame(table(imported_data$race))

# Change the column heading names to "Race" and "Shootings"
colnames(unique_races) <- c("Race", "Shootings")

# Display the values for race, and the total shootings for each, in the imported data:
kable(unique_races)
```

The cleansed breakdown is:
```{r cleanse_data_race_after, echo=FALSE}

# Create a data frame containing the unique list of race values in the cleansed data, and the number of mass shootings by each
unique_races <- data.frame(table(cleansed_data$race))

# Change the column heading names to "Race" and "Shootings"
colnames(unique_races) <- c("Race", "Shootings")

# View the values for race, and the total shootings for each, in the cleansed data:
kable(unique_races)
```  

## Data Cleansing Changes - Weapons Obtained Legally

The original breakdown of number of mass shootings by "Weapons Obtained Legally" was:

```{r cleanse_data_legally_before, echo=FALSE}

# Create a data frame containing the unique list of weapons_obtained_legally values in the original data, and the number of mass shootings by each
unique_legally <- data.frame(table(imported_data$weapons_obtained_legally))

# Change the column heading names to "Weapons Obtained Legally" and "Shootings"
colnames(unique_legally) <- c("Weapons Obtained Legally", "Shootings")

# Display the values for "Weapons Obtained Legally", and the total shootings for each, in the imported data:
kable(unique_legally)
```

The cleansed breakdown is:
```{r cleanse_data_legally_after, echo=FALSE}

# Create a data frame containing the unique list of weapons_obtained_legally values in the cleansed data, and the number of mass shootings by each
unique_legally <- data.frame(table(cleansed_data$weapons_obtained_legally))

# Change the column heading names to "Weapons Obtained Legally" and "Shootings"
colnames(unique_legally) <- c("Weapons Obtained Legally", "Shootings")

# View the values for "Weapons Obtained Legally", and the total shootings for each, in the cleansed data. Should have No 16, Unknown 15, Yes 79 Yes:
kable(unique_legally)
```
  

## Data Cleansing Changes - State

A new column was added containing the state code e.g. CA for California.

In the original data, the unique states after the comma in the location column were:

```{r cleanse_data_state_before, echo=FALSE}

# Create a data frame containing unique states in the imported data (by extracting the text after the comma in the location column) and the number of mass shootings for each:
unique_state <- data.frame(table(sub('.*\\,', '', cleansed_data$location)))

# Change the column heading names to "State" and "Shootings"
colnames(unique_state) <- c("State", "Shootings")

# Display them
kable(unique_state)
```

After cleansing, the unique states are:

```{r cleanse_data_state_after, echo=FALSE}

# Create a data frame containing unique states in the cleansed data and the number of mass shootings for each:
unique_state <- data.frame(table(cleansed_data$state))

# Change the column heading names to "State" and "Shootings"
colnames(unique_state) <- c("State", "Shootings")

# Display the new unique list of states
kable(unique_state)

```  

## Data Cleansing Changes - Location Type

The location types were:

```{r cleanse_data_loc_type_before, echo=FALSE}

# Create a data frame containing unique location types in the imported data and the number of mass shootings for each
unique_loc_type <- data.frame(table(imported_data$location.1))

# Change the column heading names to "Location Type" and "Shootings"
colnames(unique_loc_type) <- c("Location Type", "Shootings")

# Display the number of shootings per location type as per the values of location type in the imported data
kable(unique_loc_type)

```

There were 2 instances of "Workplace"" as one had a leading white space.

There were also 2 instaces of "Other"" as one with a trailing white space.

The cleansed types are:

```{r cleanse_data_loc_type_after, echo=FALSE}

# Create a data frame containing unique location types in the cleansed data and the number of mass shootings for each:
unique_loc_type <- data.frame(table(cleansed_data$location.1))

# Change the column heading names to "Location Type" and "Shootings"
colnames(unique_loc_type) <- c("Location Type", "Shootings")

# Display the new unique list of states
kable(unique_loc_type)
```  

## Data Cleansing Changes - Prior Signs Of Mental Health Issues

The values in the imported data were:

```{r cleanse_data_prior_before, echo=FALSE}

# Create a data frame containing values for prior_signs_mental_health_issues in the imported data and the number of mass shootings for each
unique_prior <- data.frame(table(imported_data$prior_signs_mental_health_issues))

# Change the column heading names to "Prior Signs Of Mental health Issues" and "Shootings"
colnames(unique_prior) <- c("Prior Signs Of Mental Health Issues", "Shootings")

# Display the number of shootings per value for prior_signs_mental_health_issues 
kable(unique_prior)

```

The values are now:

```{r cleanse_data_prior_after, echo=FALSE}

# Create a data frame containing unique values for prior_signs_mental_health_issues in the cleansed data and the number of mass shootings for each
unique_prior <- data.frame(table(cleansed_data$prior_signs_mental_health_issues))

# Change the column heading names to "Prior Signs Of Mental Health Issues" and "Shootings"
colnames(unique_prior) <- c("Prior Signs Of Mental Health Issues", "Shootings")

# Display the table of number of shootings per value for prior_signs_mental_health_issues
kable(unique_prior)

```  

